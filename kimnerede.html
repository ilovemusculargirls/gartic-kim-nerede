<!doctype html><html lang="tr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mikey Kim Nerde?</title><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"><style>:root{--bg-color:#1a1a2e;--main-area-bg:#1e2a4a;--player-item-bg:#16213e;--text-color:#e0e0e0;--accent-color:#0f3460;--player-item-border:#2a3c61;--player-item-shadow:rgba(0, 0, 0, 0.2);--button-bg:#334257;--button-hover-bg:#475a72;--button-active-bg:#5c7590;--button-text-color:#e0e0e0;--input-bg:#2a3d5f;--input-border:#3b507b;--input-text:#e0e0e0;--input-placeholder:#a0a0a0;--favorite-color-inactive:#a0a0a0;--favorite-color-active:#ffc107;--blacklist-color-inactive:#a0a0a0;--blacklist-color-active:#dc3545;--error-bg:#330d0d;--error-border:#600f0f;--error-text:#ff9999;--error-title:#ffcccc;--persistent-error-bg:#5C0000;--persistent-error-border:#990000;--persistent-error-text:#ff8888;--persistent-error-title:#ffaaaa;--cooldown-text:#ffda6a}body.theme-light{--bg-color:#f0f2f5;--main-area-bg:#ffffff;--player-item-bg:#f9f9f9;--text-color:#333333;--accent-color:#4a90e2;--player-item-border:#e0e0e0;--player-item-shadow:rgba(0, 0, 0, 0.08);--button-bg:#e0e0e0;--button-hover-bg:#d0d0d0;--button-active-bg:#c0c0c0;--button-text-color:#333333;--input-bg:#f0f0f0;--input-border:#d0d0d0;--input-text:#333333;--input-placeholder:#888888;--favorite-color-inactive:#888888;--favorite-color-active:#ffbb00;--blacklist-color-inactive:#888888;--blacklist-color-active:#cc3333;--error-bg:#ffe0e0;--error-border:#ff6666;--error-text:#cc0000;--error-title:#aa0000;--persistent-error-bg:#ffc8c8;--persistent-error-border:#ff0000;--persistent-error-text:#bb0000;--persistent-error-title:#990000;--cooldown-text:#e69900}body.theme-ocean{--bg-color:#0f1c30;--main-area-bg:#1a2a40;--player-item-bg:#132130;--text-color:#e0f2f7;--accent-color:#007bff;--player-item-border:#2c4a6a;--player-item-shadow:rgba(0, 0, 0, 0.25);--button-bg:#21406b;--button-hover-bg:#2e538d;--button-active-bg:#3a68ab;--button-text-color:#e0f2f7;--input-bg:#1c3350;--input-border:#2a476c;--input-text:#e0f2f7;--input-placeholder:#a5b9c7;--favorite-color-inactive:#a5b9c7;--favorite-color-active:#ffe64d;--blacklist-color-inactive:#a5b9c7;--blacklist-color-active:#f73b3b;--error-bg:#290a0a;--error-border:#5c0f0f;--error-text:#ff8a8a;--error-title:#ffc4c4;--persistent-error-bg:#4f0000;--persistent-error-border:#7f0000;--persistent-error-text:#ff7777;--persistent-error-title:#e00000;--cooldown-text:#ffdf70}body.theme-forest{--bg-color:#1e2a22;--main-area-bg:#2a3d2e;--player-item-bg:#223328;--text-color:#e6f0e6;--accent-color:#28a745;--player-item-border:#3b523e;--player-item-shadow:rgba(0, 0, 0, 0.2);--button-bg:#3b523e;--button-hover-bg:#4a664f;--button-active-bg:#5a7d60;--button-text-color:#e6f0e6;--input-bg:#2f4535;--input-border:#425c46;--input-text:#e6f0e6;--input-placeholder:#a0b0a0;--favorite-color-inactive:#a0b0a0;--favorite-color-active:#ffd700;--blacklist-color-inactive:#a0b0a0;--blacklist-color-active:#e74c3c;--error-bg:#2b0e0e;--error-border:#5d1212;--error-text:#ff8888;--error-title:#ffc0c0;--persistent-error-bg:#550000;--persistent-error-border:#880000;--persistent-error-text:#ff7777;--persistent-error-title:#e60000;--cooldown-text:#ffec80}body.theme-purple{--bg-color:#2e1a3a;--main-area-bg:#3e2a4a;--player-item-bg:#21163e;--text-color:#f0e6ff;--accent-color:#8c00b7;--player-item-border:#4a3c61;--player-item-shadow:rgba(0, 0, 0, 0.2);--button-bg:#4a3c61;--button-hover-bg:#5c4e72;--button-active-bg:#6e6085;--button-text-color:#f0e6ff;--input-bg:#3d2a5f;--input-border:#503b7b;--input-text:#f0e6ff;--input-placeholder:#b0a0c0;--favorite-color-inactive:#b0a0c0;--favorite-color-active:#ffd700;--blacklist-color-inactive:#b0a0c0;--blacklist-color-active:#dc3545;--error-bg:#330d0d;--error-border:#600f0f;--error-text:#ff9999;--error-title:#ffcccc;--persistent-error-bg:#5C0000;--persistent-error-border:#990000;--persistent-error-text:#ff8888;--persistent-error-title:#ffaaaa;--cooldown-text:#ffda6a}body.theme-lightblue{--bg-color:#d6eaf8;--main-area-bg:#eaf6fd;--player-item-bg:#ffffff;--text-color:#2c3e50;--accent-color:#3498db;--player-item-border:#aed6f1;--player-item-shadow:rgba(0, 0, 0, 0.12);--button-bg:#85c1e9;--button-hover-bg:#5dade2;--button-active-bg:#2e86c1;--button-text-color:#2c3e50;--input-bg:#ecf0f1;--input-border:#bbd3e6;--input-text:#2c3e50;--input-placeholder:#7f8c8d;--favorite-color-inactive:#7f8c8d;--favorite-color-active:#f39c12;--blacklist-color-inactive:#7f8c8d;--blacklist-color-active:#e74c3c;--error-bg:#fdeded;--error-border:#f5b7b1;--error-text:#c0392b;--error-title:#e74c3c;--persistent-error-bg:#f9dcdc;--persistent-error-border:#f08080;--persistent-error-text:#c0392b;--persistent-error-title:#e74c3c;--cooldown-text:#f1c40f}body.theme-pink{--bg-color:#ffebee;--main-area-bg:#fce4ec;--player-item-bg:#ffffff;--text-color:#880e4f;--accent-color:#e91e63;--player-item-border:#f8bbd0;--player-item-shadow:rgba(0, 0, 0, 0.1);--button-bg:#f48fb1;--button-hover-bg:#ec407a;--button-active-bg:#d81b60;--button-text-color:#880e4f;--input-bg:#ffebee;--input-border:#f8bbd0;--input-text:#880e4f;--input-placeholder:#c2185b;--favorite-color-inactive:#c2185b;--favorite-color-active:#ffc107;--blacklist-color-inactive:#c2185b;--blacklist-color-active:#d32f2f;--error-bg:#fbe9e7;--error-border:#ffab91;--error-text:#d84315;--error-title:#bf360c;--persistent-error-bg:#ffccbc;--persistent-error-border:#ff8a65;--persistent-error-text:#d84315;--persistent-error-title:#bf360c;--cooldown-text:#ff6f00}body,html{height:100%;margin:0;padding:0;box-sizing:border-box}body{font-family:Poppins,sans-serif;background-color:var(--bg-color);color:var(--text-color);display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px;transition:background-color .3s ease,color .3s ease}.container{width:100%;padding:0;box-sizing:border-box;max-width:1200px}h1{text-align:center;color:var(--text-color);margin-bottom:5px;font-weight:600;letter-spacing:1px}#room-status-message{text-align:center;color:var(--text-color);font-size:.9em;margin-bottom:25px;min-height:1.2em}.filters-container{display:flex;flex-direction:column;gap:15px;margin-bottom:25px;justify-content:center;padding:15px;background-color:var(--main-area-bg);border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.2);width:100%;box-sizing:border-box;transition:background-color .3s ease}.filter-group{display:flex;flex-direction:column;align-items:center;gap:8px;width:100%}.filter-group.inline-filters{flex-direction:row;flex-wrap:wrap;justify-content:center;gap:15px}.filter-group.inline-filters>div{display:flex;flex-direction:column;align-items:center;gap:8px}.filter-group label{font-size:.9em;font-weight:500;color:var(--text-color);margin-bottom:5px}.filter-buttons{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;width:100%}.filter-button{background-color:var(--button-bg);color:var(--button-text-color);border:none;padding:8px 15px;border-radius:6px;cursor:pointer;font-size:.9em;transition:background-color .2s ease,transform .1s ease;white-space:nowrap}.filter-button:hover{background-color:var(--button-hover-bg)}.filter-button.active{background-color:var(--button-active-bg);box-shadow:inset 0 2px 4px rgba(0,0,0,.3);transform:translateY(1px)}#language-select,#search-input,#theme-select{flex:1;min-width:180px;max-width:250px;width:auto;padding:10px 15px;border:1px solid var(--input-border);border-radius:8px;background-color:var(--input-bg);color:var(--input-text);font-size:1em;outline:0;transition:border-color .2s ease,box-shadow .2s ease,background-color .3s ease,color .3s ease;text-align:center;appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23e0e0e0%22%20d%3D%22M287%2C114.3L146.2%2C255.1L5.4%2C114.3H287z%22%2F%3E%3C%2Fsvg%3E');background-repeat:no-repeat;background-position:right 10px top 50%;background-size:12px auto;padding-right:30px;cursor:pointer}#search-input::placeholder{color:var(--input-placeholder)}#language-select:focus,#search-input:focus,#theme-select:focus{border-color:var(--accent-color);box-shadow:0 0 0 3px rgba(15,52,96,.5)}#language-select:disabled,#refresh-button:disabled{opacity:.6;cursor:not-allowed}#language-select option,#theme-select option{background-color:var(--input-bg);color:var(--input-text)}#refresh-button{background-color:var(--button-bg);color:var(--button-text-color);border:none;padding:10px 15px;border-radius:8px;cursor:pointer;font-size:1em;transition:background-color .2s ease,transform .1s ease;display:flex;align-items:center;gap:5px;justify-content:center;flex:1;min-width:100px;max-width:180px}#refresh-button:hover{background-color:var(--button-hover-bg)}#refresh-button:active{transform:translateY(1px)}#players-list-container{display:flex;flex-wrap:wrap;gap:12px;padding:20px;background-color:var(--main-area-bg);border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,.35);justify-content:center;width:100%;box-sizing:border-box;transition:background-color .3s ease}.player-item{background-color:var(--player-item-bg);border-radius:8px;padding:10px 10px;display:flex;align-items:center;gap:8px;border:1px solid var(--player-item-border);box-shadow:0 2px 5px var(--player-item-shadow);width:200px;flex-shrink:0;position:relative;overflow:hidden;transition:transform .2s ease,box-shadow .2s ease,background-color .3s ease,border-color .3s ease}.player-item:hover{transform:translateY(-3px);box-shadow:0 4px 10px rgba(0,0,0,.3)}.player-item.hidden{display:none!important}.player-avatar-link{display:block;flex-shrink:0;z-index:2;position:relative}.player-avatar{width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid var(--accent-color);display:block}.player-info{display:flex;flex-direction:column;flex-grow:1;min-width:0;z-index:2;position:relative}.player-nick{font-weight:500;color:var(--text-color);font-size:.9em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.player-stats{font-size:.75em;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px}.player-room-info{font-size:.7em;color:var(--text-color);margin-top:3px}.player-room-link{text-decoration:none;font-weight:500;transition:color .3s ease}.player-room-link:hover{text-decoration:underline}.favorite-button{position:absolute;top:5px;right:5px;background:0 0;border:none;cursor:pointer;font-size:1.1em;color:var(--favorite-color-inactive);transition:color .2s ease,transform .1s ease;padding:8px;z-index:3}.favorite-button:hover{transform:scale(1.2)}.favorite-button.active{color:var(--favorite-color-active);transform:scale(1.1)}.blacklist-button{position:absolute;top:5px;right:30px;background:0 0;border:none;cursor:pointer;font-size:1.1em;color:var(--blacklist-color-inactive);transition:color .2s ease,transform .1s ease;padding:8px;z-index:3}.blacklist-button:hover{transform:scale(1.2)}.blacklist-button.active{color:var(--blacklist-color-active);transform:scale(1.1)}.blacklist-image-overlay{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:8px;z-index:0;opacity:0;pointer-events:none;transition:opacity .3s ease;overflow:hidden}.player-item.blacklisted .blacklist-image-overlay{opacity:1}.blacklist-image-overlay img{width:100%;height:100%;object-fit:cover;border-radius:8px;filter:none}.no-players{text-align:center;color:var(--input-placeholder);font-style:italic;padding:20px;width:100%}#cooldown-message{font-size:.85em;color:var(--cooldown-text);margin-top:5px;text-align:center;width:100%}#refresh-cooldown-message{font-size:.85em;color:var(--cooldown-text);margin-top:5px;text-align:center;width:100%;display:none}#scrollTopBtn{display:none;position:fixed;bottom:20px;right:20px;z-index:99;font-size:24px;border:none;outline:0;background-color:var(--accent-color);color:var(--button-text-color);cursor:pointer;padding:10px 15px;border-radius:50%;box-shadow:0 4px 8px rgba(0,0,0,.3);transition:background-color .3s ease,transform .2s ease}#scrollTopBtn:hover{background-color:var(--button-hover-bg);transform:translateY(-2px)}@media (max-width:992px){.filter-group.inline-filters{flex-direction:row}#language-select,#refresh-button,#search-input,#theme-select{max-width:200px;min-width:160px}}@media (max-width:768px){#players-list-container{padding:15px;gap:10px}.player-avatar,.player-avatar-link{width:35px;height:35px}.player-nick{font-size:.85em}.player-room-info,.player-stats{font-size:.7em}.filter-button{padding:7px 12px;font-size:.85em}.filter-group.inline-filters{flex-direction:column;gap:10px}.filter-group.inline-filters>div{width:100%}#language-select,#refresh-button,#search-input,#theme-select{width:90%;max-width:300px}.favorite-button{font-size:1em;top:5px;right:5px;padding:6px}.blacklist-button{font-size:1em;top:5px;right:30px;padding:6px}#scrollTopBtn{font-size:20px;padding:8px 12px;bottom:15px;right:15px}}@media (max-width:480px){body{padding:10px}h1{font-size:1.8em;margin-bottom:5px}#room-status-message{font-size:.8em;margin-bottom:20px}.filters-container{flex-direction:column;align-items:center;gap:15px;padding:10px}.filter-group{width:100%;text-align:center}.filter-buttons{flex-wrap:wrap;justify-content:center}#players-list-container{padding:10px;gap:8px;justify-content:center}.player-item{width:100%;max-width:250px;flex-direction:row;align-items:center}.player-avatar,.player-avatar-link{width:35px;height:35px}.player-info{gap:2px}.player-nick{font-size:.9em}.player-room-info,.player-stats{font-size:.7em}#language-select,#refresh-button,#search-input,#theme-select{width:100%}.favorite-button{font-size:.9em;top:3px;right:3px;padding:5px}.blacklist-button{font-size:.9em;top:3px;right:25px;padding:5px}#scrollTopBtn{font-size:18px;padding:7px 10px;bottom:10px;right:10px}}</style></head><body><div class="container"><h1>Mikey Kim Nerede?</h1><p id="room-status-message"></p><div class="filters-container"><div class="filter-group"><label>Filtreler:</label><div class="filter-buttons"><button class="filter-button active" data-filter="all-avatars">Tümü</button> <button class="filter-button" data-filter="photo-avatars">Fotoğrafı Olanlar</button> <button class="filter-button" data-filter="default-avatars">Avatarı Olanlar</button> <button class="filter-button" data-filter="favorite-players">Favorilerim</button> <button class="filter-button" data-filter="blacklisted-players">Karalistem</button></div></div><div class="filter-group inline-filters"><div><label for="language-select">Dil Seçin:</label> <select id="language-select"></select> <span id="cooldown-message" style="display:none"></span></div><div><label for="theme-select">Tema Seçin:</label> <select id="theme-select"></select></div><div><label for="search-input">Oyuncu Ara:</label> <input id="search-input" placeholder="Oyuncu adı veya oda kodu..."></div><div><label for="refresh-button">Yenile:</label> <button id="refresh-button" disabled><i class="fas fa-sync-alt"></i> Yenile</button> <span id="refresh-cooldown-message" style="display:none"></span></div></div></div><div id="players-list-container"></div></div><button onclick="scrollToTop()" id="scrollTopBtn" title="Yukarı Çık"><i class="fas fa-arrow-up"></i></button><script>const languageFlags={23:{name:'Azərbaycanca',flag:'🇦🇿'},45:{name:'Bahasa Indonesia',flag:'🇮🇩'},11:{name:'Čeština',flag:'🇨🇿'},14:{name:'Deutsch',flag:'🇩🇪'},2:{name:'English',flag:'🇬🇧'},3:{name:'Español',flag:'🇪🇸'},4:{name:'Français',flag:'🇫🇷'},6:{name:'Italiano',flag:'🇮🇹'},44:{name:'Magyar',flag:'🇭🇺'},18:{name:'Nederlands',flag:'🇳🇱'},10:{name:'Polski',flag:'🇵🇱'},1:{name:'Português',flag:'🇵🇹'},58:{name:'Română',flag:'🇷🇴'},22:{name:'Slovenčina',flag:'🇸🇰'},13:{name:'Tiếng Việt',flag:'🇻🇳'},8:{name:'Türkçe',flag:'🇹🇷'},21:{name:'български език',flag:'🇧🇬'},7:{name:'Русский',flag:'🇷🇺'},40:{name:'עברית',flag:'🇮🇱'},19:{name:'العربية',flag:'🇸🇦'},34:{name:'فارسی',flag:'🇮🇷'},12:{name:'ภาษาไทย',flag:'🇹🇭'},16:{name:'中文 (简化字)',flag:'🇨🇳'},9:{name:'中文 (臺灣)',flag:'🇹🇼'},17:{name:'中文 (香港)',flag:'🇭🇰'},15:{name:'日本語',flag:'🇯🇵'},20:{name:'한국어',flag:'🇰🇷'},26:{name:'Afrikaans',flag:'🇿🇦'},55:{name:'Bahasa Melayu',flag:'🇲🇾'},30:{name:'Català',flag:'🇪🇸'},31:{name:'Dansk',flag:'🇩🇰'},33:{name:'Eesti',flag:'🇪🇪'},67:{name:'Esperanto',flag:'🏳️'},36:{name:'Føroyskt',flag:'🇫🇴'},37:{name:'Gaeilge',flag:'🇮🇪'},38:{name:'Galego',flag:'🇪🇸'},43:{name:'Hrvatski',flag:'🇭🇷'},46:{name:'Íslenska',flag:'🇮🇸'},52:{name:'Latviešu',flag:'🇱🇻'},50:{name:'Lëtzebuergesch',flag:'🇱🇺'},68:{name:'Lietuvių',flag:'🇱🇹'},56:{name:'Malti',flag:'🇲🇹'},53:{name:'Mакедонски',flag:'🇲🇰'},65:{name:'Norsk',flag:'🇳🇴'},61:{name:'Shqip',flag:'🇦🇱'},59:{name:'Slovenščina',flag:'🇸🇮'},35:{name:'Suomi',flag:'🇫🇮'},24:{name:'Svenska',flag:'🇸🇪'},62:{name:'Türkmen',flag:'🇹🇲'},64:{name:'Yorùbá',flag:'🇳🇬'},32:{name:'Ελληνικά',flag:'🇬🇷'},27:{name:'Беларуская',flag:'🇧🇾'},29:{name:'Босански',flag:'🇧🇦'},54:{name:'Монгол Хэл',flag:'🇲🇳'},60:{name:'Српски',flag:'🇷🇸'},63:{name:'Українська',flag:'🇺🇦'},49:{name:'Қазақ Tілі',flag:'🇰🇿'},42:{name:'Հայերեն',flag:'🇦🇲'},41:{name:'हिन्दी',flag:'🇮🇳'},28:{name:'বাংলা',flag:'🇧🇩'},39:{name:'ગુજરાતી',flag:'🇮🇳'},51:{name:'ພາສາລາວ',flag:'🇱🇦'},57:{name:'မြန်မာစကား',flag:'🇲🇲'},47:{name:'ქართული',flag:'🇬🇪'},25:{name:'ኣማርኛ',flag:'🇪🇹'},48:{name:'ភាសាខ្មែរ',flag:'🇰🇭'},};const themes={'dark-default':'Koyu Varsayılan','light':'Açık','ocean':'Okyanus Mavisi','forest':'Orman Yeşili','purple':'Mor Akşam','lightblue':'Açık Mavi','pink':'Pembe'};window.roomData={};let isFetching=!1;const delayBetweenRequests=1800;const websocketTimeout=3000;const refreshInterval=60000;const cooldownDuration=10000;let refreshIntervalId;const roomRetryCounts={};const roomColors={};let existingPlayerIds=new Set();let currentAvatarFilter='all-avatars';let currentSearchTerm='';let favoritePlayerIds=new Set();let blacklistedPlayerIds=new Set();let currentMainFetchAbortController=null;let sharedCooldownTimerId=null;let totalRoomsToProcess=0;let roomsProcessedCount=0;const roomStatusMessageElement=document.getElementById('room-status-message');const BLACKLIST_IMAGE_URL='https://raw.githubusercontent.com/ilovemusculargirls/gartic-kim-nerede/refs/heads/main/oc3.png';function generateRandomColor(){const randomColor='#'+Math.floor(Math.random()*16777215).toString(16).padStart(6,'0');return randomColor}
function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}
function loadFavorites(){const favoritesJSON=localStorage.getItem('garticFavorites');if(favoritesJSON){try{const parsedFavorites=JSON.parse(favoritesJSON);favoritePlayerIds=new Set(parsedFavorites)}catch(e){favoritePlayerIds=new Set()}}}
function saveFavorites(){localStorage.setItem('garticFavorites',JSON.stringify(Array.from(favoritePlayerIds)))}
function loadBlacklist(){const blacklistJSON=localStorage.getItem('garticBlacklist');if(blacklistJSON){try{const parsedBlacklist=JSON.parse(blacklistJSON);blacklistedPlayerIds=new Set(parsedBlacklist)}catch(e){blacklistedPlayerIds=new Set()}}}
function saveBlacklist(){localStorage.setItem('garticBlacklist',JSON.stringify(Array.from(blacklistedPlayerIds)))}
function addFavorite(playerId){favoritePlayerIds.add(playerId);if(blacklistedPlayerIds.has(playerId)){removeBlacklist(playerId)}
saveFavorites();updateFavoriteAndBlacklistButtons(playerId)}
function removeFavorite(playerId){favoritePlayerIds.delete(playerId);saveFavorites();updateFavoriteAndBlacklistButtons(playerId)}
function addBlacklist(playerId){blacklistedPlayerIds.add(playerId);if(favoritePlayerIds.has(playerId)){removeFavorite(playerId)}
saveBlacklist();updateFavoriteAndBlacklistButtons(playerId)}
function removeBlacklist(playerId){blacklistedPlayerIds.delete(playerId);saveBlacklist();updateFavoriteAndBlacklistButtons(playerId)}
function updateFavoriteAndBlacklistButtons(playerId){const playerItem=document.querySelector(`.player-item[data-player-id="${playerId}"]`);if(playerItem){const favoriteButton=playerItem.querySelector('.favorite-button');const blacklistButton=playerItem.querySelector('.blacklist-button');if(favoriteButton){if(favoritePlayerIds.has(playerId)){favoriteButton.classList.add('active')}else{favoriteButton.classList.remove('active')}}
if(blacklistButton){if(blacklistedPlayerIds.has(playerId)){blacklistButton.classList.add('active');playerItem.classList.add('blacklisted')}else{blacklistButton.classList.remove('active');playerItem.classList.remove('blacklisted')}}}
applyFilters()}
async function fetchPlayersViaWebSocket(serverName,roomGarticId,roomCodeFull){const roomUrl=`https://gartic.io/${roomCodeFull}`;const currentServerUrl=`wss://${serverName}.gartic.io/socket.io/?EIO=3&transport=websocket`;return new Promise((resolve,reject)=>{const ws=new WebSocket(currentServerUrl);let timeoutId;ws.onopen=()=>{ws.send('42[12,{"v":20000,"platform":0,"sala":"'+roomGarticId+'"}]');timeoutId=setTimeout(()=>{ws.close();reject(new Error(`WebSocket timeout for ${serverName} for room ${roomCodeFull}`))},websocketTimeout)};ws.onmessage=(msg)=>{if(msg.data&&msg.data.length>=5){const messageType=msg.data[4];if(messageType==="5"){try{const data=JSON.parse(msg.data.slice(2));if(data[0]==="5"&&data[5]&&Array.isArray(data[5])){let players;try{players=data[5].map(user=>({points:user.pontos||0,victory:user.vitorias||0,id:user.id,avatar:user.foto?user.foto:(typeof user.avatar==='number'?`https://gartic.io/static/images/avatar/svg/${user.avatar}.svg`:'https://gartic.io/images/avatar/0.svg'),avatarType:user.foto?'photo':'default',nick:user.nick,}))}catch(mapError){players=[]}
clearTimeout(timeoutId);ws.close();resolve({players:players,serverAddress:currentServerUrl});return}}catch(e){}}}};ws.onerror=(error)=>{clearTimeout(timeoutId);ws.close();reject(new Error(`WebSocket connection error for ${serverName}: ${error.message}`))};ws.onclose=()=>{clearTimeout(timeoutId)}})}
async function processRoomsSequentially(roomsToProcess,signal){const successfulRoomsInPass=[];totalRoomsToProcess=roomsToProcess.length;roomsProcessedCount=0;updateRoomStatusMessage();for(const room of roomsToProcess){if(signal.aborted){break}
const roomCode=room.code;const roomGarticId=room.id;const roomUrl=`https://gartic.io/${roomCode}`;let playersDataForCurrentRoom=[];let currentRoomProcessingSuccessful=!1;let shouldSleepAfterThisRoom=!0;if(!roomColors[roomCode]){roomColors[roomCode]=generateRandomColor()}
const assignedColor=roomColors[roomCode];if(!window.roomData[roomUrl]){window.roomData[roomUrl]={code:roomCode,players:[],serverAddress:'Bilinmiyor',color:assignedColor}}else{window.roomData[roomUrl].color=assignedColor}
try{const serverViewerUrl=`https://gartic.io/serverViewer?v3=1&room=${roomCode}`;const response=await fetch(serverViewerUrl,{signal:signal});if(!response.ok){shouldSleepAfterThisRoom=!1}else{const responseText=await response.text();let serverName='';if(responseText.startsWith("https://server")&&responseText.includes(".gartic.io")){const match=responseText.match(/https:\/\/(server\d{2})\.gartic\.io/);if(match&&match[1]){serverName=match[1];window.roomData[roomUrl].serverAddress=`wss://${serverName}.gartic.io/socket.io/?EIO=3&transport=websocket`;try{const result=await fetchPlayersViaWebSocket(serverName,roomGarticId,roomCode);playersDataForCurrentRoom=result.players;currentRoomProcessingSuccessful=!0}catch(wsError){shouldSleepAfterThisRoom=!1}}else{shouldSleepAfterThisRoom=!1}}else{shouldSleepAfterThisRoom=!1}}}catch(error){if(error.name==='AbortError'){shouldSleepAfterThisRoom=!1}else{shouldSleepAfterThisRoom=!1}}
if(currentRoomProcessingSuccessful){const existingPlayerIdsInRoom=new Set(window.roomData[roomUrl].players.map(p=>p.id));const newPlayersInThisRoom=playersDataForCurrentRoom.filter(p=>!existingPlayerIdsInRoom.has(p.id));window.roomData[roomUrl].players.push(...newPlayersInThisRoom);successfulRoomsInPass.push(room)}
roomsProcessedCount++;updateRoomStatusMessage();renderNewPlayersOnly();if(shouldSleepAfterThisRoom&&!signal.aborted){await sleep(delayBetweenRequests)}}
return successfulRoomsInPass}
function updateRoomStatusMessage(){if(isFetching){if(totalRoomsToProcess>0){roomStatusMessageElement.textContent=`Toplam oda:${totalRoomsToProcess} Alınan oda sayısı: ${roomsProcessedCount}`}else{roomStatusMessageElement.textContent='Aktif oda aranıyor...'}
roomStatusMessageElement.style.display='block'}else{if(Object.keys(window.roomData).length>0){roomStatusMessageElement.textContent=`Toplam ${Object.keys(window.roomData).length} oda bulundu.`}else{roomStatusMessageElement.textContent='Aktif oda bulunamadı.'}
const noPlayersMessageElement=document.getElementById('no-players-message-after-filter');if(noPlayersMessageElement&&noPlayersMessageElement.style.display==='block'){roomStatusMessageElement.textContent=''}else if(Object.keys(window.roomData).length===0&&!noPlayersMessageElement){roomStatusMessageElement.textContent='Aktif oyuncu bulunamadı veya bilgiler henüz yüklenmedi.'}}}
function renderNewPlayersOnly(){const container=document.getElementById('players-list-container');const fragment=document.createDocumentFragment();let allCurrentPlayers=[];Object.values(window.roomData).forEach(room=>{room.players.forEach(player=>{allCurrentPlayers.push({...player,roomCode:room.code,roomColor:room.color})})});const loadingMessage=document.getElementById('loading-message-dynamic');if(loadingMessage){loadingMessage.remove()}
const playersToAdd=allCurrentPlayers.filter(player=>!existingPlayerIds.has(player.id));playersToAdd.sort((a,b)=>{const roomCodeComparison=a.roomCode.localeCompare(b.roomCode);if(roomCodeComparison!==0){return roomCodeComparison}
if(b.points!==a.points){return b.points-a.points}
return b.victory-a.victory});playersToAdd.forEach(player=>{const playerItemDiv=document.createElement('div');playerItemDiv.classList.add('player-item');playerItemDiv.dataset.playerId=player.id;playerItemDiv.dataset.avatarType=player.avatarType;playerItemDiv.dataset.playerNick=player.nick.toLowerCase();playerItemDiv.dataset.roomCode=player.roomCode.toLowerCase();const isFavorite=favoritePlayerIds.has(player.id.toString());const favoriteClass=isFavorite?'active':'';const isBlacklisted=blacklistedPlayerIds.has(player.id.toString());const blacklistedClass=isBlacklisted?'active':'';if(isBlacklisted){playerItemDiv.classList.add('blacklisted')}
playerItemDiv.innerHTML=`
                    <a href="${player.avatar}" target="_blank" rel="noopener noreferrer" class="player-avatar-link">
                        <img src="${player.avatar}" alt="${player.nick}" class="player-avatar">
                    </a>
                    <div class="player-info">
                        <span class="player-nick">${player.nick}</span>
                        <span class="player-stats">P: ${player.points} | G: ${player.victory}</span>
                        <div class="player-room-info">
                            Oda: <a href="https://gartic.io/${player.roomCode}" target="_blank" class="player-room-link" style="color: ${player.roomColor};">#${player.roomCode}</a>
                            İzle: <a href="https://gartic.io/${player.roomCode}/viewer" target="_blank" class="player-room-link" style="color: ${player.roomColor};">#${player.roomCode} izle</a>
                        </div>
                    </div>
                    <button class="blacklist-button ${blacklistedClass}" data-player-id="${player.id}">
                        <i class="fa-solid fa-ban"></i>
                    </button>
                    <button class="favorite-button ${favoriteClass}" data-player-id="${player.id}">
                        <i class="fa-solid fa-star"></i>
                    </button>
                    <div class="blacklist-image-overlay">
                        <img src="${BLACKLIST_IMAGE_URL}" alt="Blacklisted">
                    </div>
                `;fragment.appendChild(playerItemDiv);existingPlayerIds.add(player.id)});container.appendChild(fragment);applyFilters();document.querySelectorAll('.player-item').forEach(item=>{updateFavoriteAndBlacklistButtons(item.dataset.playerId)})}
function applyFilters(){const playerItems=document.querySelectorAll('.player-item');let visiblePlayersCount=0;const searchTermLower=currentSearchTerm.toLowerCase();const playersListContainer=document.getElementById('players-list-container');const noPlayersMessageElementId='no-players-message-after-filter';let noPlayersMessageElement=document.getElementById(noPlayersMessageElementId);playerItems.forEach(item=>{const avatarType=item.dataset.avatarType;const playerNick=item.dataset.playerNick;const roomCode=item.dataset.roomCode;const playerId=item.dataset.playerId;const isFavorite=favoritePlayerIds.has(playerId);const isBlacklisted=blacklistedPlayerIds.has(playerId);let passesAvatarFilter=!1;switch(currentAvatarFilter){case 'all-avatars':passesAvatarFilter=!isBlacklisted;break;case 'photo-avatars':passesAvatarFilter=(avatarType==='photo'&&!isBlacklisted);break;case 'default-avatars':passesAvatarFilter=(avatarType==='default'&&!isBlacklisted);break;case 'favorite-players':passesAvatarFilter=isFavorite;break;case 'blacklisted-players':passesAvatarFilter=isBlacklisted;break}
let passesSearchFilter=!0;if(searchTermLower){if(!playerNick.includes(searchTermLower)&&!roomCode.includes(searchTermLower)){passesSearchFilter=!1}}
if(passesAvatarFilter&&passesSearchFilter){item.classList.remove('hidden');visiblePlayersCount++}else{item.classList.add('hidden')}});if(visiblePlayersCount===0){let messageText='Filtrelemeye uyan oyuncu bulunamadı.';if(currentAvatarFilter==='favorite-players'){messageText=favoritePlayerIds.size===0?'Henüz favori oyuncunuz bulunmamaktadır.':'Favori oyuncularınız arasında filtrenize uyan bulunamadı.'}else if(currentAvatarFilter==='blacklisted-players'){messageText=blacklistedPlayerIds.size===0?'Karalistenizde henüz oyuncu bulunmamaktadır.':'Karalistenizdeki oyuncular arasında filtrenize uyan bulunamadı.'}else if(Object.keys(window.roomData).length===0&&!isFetching){messageText='Aktif oyuncu bulunamadı veya bilgiler henüz yüklenmedi.'}
if(!noPlayersMessageElement){noPlayersMessageElement=document.createElement('p');noPlayersMessageElement.classList.add('no-players');noPlayersMessageElement.id=noPlayersMessageElementId;playersListContainer.appendChild(noPlayersMessageElement)}
noPlayersMessageElement.textContent=messageText;noPlayersMessageElement.style.display='block';roomStatusMessageElement.style.display='none'}else{if(noPlayersMessageElement){noPlayersMessageElement.style.display='none'}
updateRoomStatusMessage()}}
async function fetchAllRoomData(){if(isFetching){return}
isFetching=!0;totalRoomsToProcess=0;roomsProcessedCount=0;updateRoomStatusMessage();currentMainFetchAbortController=new AbortController();const signal=currentMainFetchAbortController.signal;const playersListContainer=document.getElementById('players-list-container');let loadingMessageElement=document.getElementById('loading-message-dynamic');if(!loadingMessageElement){loadingMessageElement=document.createElement('p');loadingMessageElement.id='loading-message-dynamic';loadingMessageElement.classList.add('no-players');loadingMessageElement.textContent='Yükleniyor... Lütfen bekleyin.';playersListContainer.prepend(loadingMessageElement)}else{loadingMessageElement.textContent='Yükleniyor... Lütfen bekleyin.';loadingMessageElement.style.display='block'}
try{const roomListResponse=await fetch("https://gartic.io/req/list?search=&language[]="+window.lang,{cache:'no-store',signal:signal});if(!roomListResponse.ok){throw new Error(`Oda listesi çekilemedi: ${roomListResponse.statusText}`)}
let roomList=await roomListResponse.json();const activeRooms=roomList.filter(room=>room.quant>0);totalRoomsToProcess=activeRooms.length;updateRoomStatusMessage();if(activeRooms.length===0){window.roomData={};existingPlayerIds.clear();playersListContainer.innerHTML='<p class="no-players" id="no-players-message-after-filter">Aktif oyuncu bulunamadı veya bilgiler henüz yüklenmedi.</p>';updateRoomStatusMessage()}else{await processRoomsSequentially(activeRooms,signal)}}catch(error){if(error.name==='AbortError'){}else{const playersListContainer=document.getElementById('players-list-container');if(playersListContainer){playersListContainer.innerHTML='<p class="no-players">Oyuncu listesi yüklenemedi veya bir hata oluştu. Lütfen daha sonra tekrar deneyin.</p>'}}}finally{isFetching=!1;if(loadingMessageElement)loadingMessageElement.remove();updateRoomStatusMessage()}}
function setupFilterButtons(){const filterButtons=document.querySelectorAll('.filter-button');filterButtons.forEach(button=>{button.addEventListener('click',()=>{filterButtons.forEach(btn=>btn.classList.remove('active'));button.classList.add('active');currentAvatarFilter=button.dataset.filter;applyFilters()})})}
function setupSearchInput(){const searchInput=document.getElementById('search-input');searchInput.addEventListener('keyup',()=>{currentSearchTerm=searchInput.value.trim();applyFilters()})}
function applySharedCooldown(durationInSeconds){const languageSelect=document.getElementById('language-select');const refreshButton=document.getElementById('refresh-button');const cooldownMessage=document.getElementById('cooldown-message');const refreshCooldownMessage=document.getElementById('refresh-cooldown-message');if(sharedCooldownTimerId){clearInterval(sharedCooldownTimerId)}
languageSelect.disabled=!0;refreshButton.disabled=!0;cooldownMessage.style.display='block';refreshCooldownMessage.style.display='block';let remainingTime=durationInSeconds;const updateCooldownDisplay=()=>{if(remainingTime>0){cooldownMessage.textContent=`Dil ${remainingTime} saniye boyunca değiştirilemez.`;refreshCooldownMessage.textContent=`Yenileme ${remainingTime} saniye boyunca kullanılamaz.`;remainingTime--}else{clearInterval(sharedCooldownTimerId);languageSelect.disabled=!1;refreshButton.disabled=!1;cooldownMessage.style.display='none';refreshCooldownMessage.style.display='none';cooldownMessage.textContent='';refreshCooldownMessage.textContent='';sharedCooldownTimerId=null}};updateCooldownDisplay();sharedCooldownTimerId=setInterval(updateCooldownDisplay,1000)}
function populateLanguageSelect(){const selectElement=document.getElementById('language-select');selectElement.innerHTML='';const sortedLanguageKeys=Object.keys(languageFlags).sort((a,b)=>{const nameA=languageFlags[a].name.toLowerCase();const nameB=languageFlags[b].name.toLowerCase();return nameA.localeCompare(nameB)});sortedLanguageKeys.forEach(langKey=>{const lang=languageFlags[langKey];const option=document.createElement('option');option.value=langKey;option.textContent=`${lang.flag} ${lang.name}`;selectElement.appendChild(option)});const savedLang=localStorage.getItem('garticSelectedLanguage');if(savedLang&&languageFlags[savedLang]){window.lang=savedLang}else{window.lang="8"}
selectElement.value=window.lang;selectElement.addEventListener('change',(event)=>{if(sharedCooldownTimerId){selectElement.value=window.lang;return}
applySharedCooldown(cooldownDuration/1000);roomStatusMessageElement.textContent='';if(refreshIntervalId){clearInterval(refreshIntervalId)}
if(currentMainFetchAbortController){currentMainFetchAbortController.abort();currentMainFetchAbortController=null}
window.roomData={};existingPlayerIds.clear();document.getElementById('players-list-container').innerHTML='';window.lang=event.target.value;localStorage.setItem('garticSelectedLanguage',window.lang);setTimeout(()=>{startAutoRefresh()},2000)})}
function populateThemeSelect(){const themeSelect=document.getElementById('theme-select');themeSelect.innerHTML='';for(const themeKey in themes){const option=document.createElement('option');option.value=themeKey;option.textContent=themes[themeKey];themeSelect.appendChild(option)}
const savedTheme=localStorage.getItem('garticSelectedTheme');if(savedTheme&&themes[savedTheme]){applyTheme(savedTheme);themeSelect.value=savedTheme}else{applyTheme('dark-default');themeSelect.value='dark-default'}
themeSelect.addEventListener('change',(event)=>{const selectedTheme=event.target.value;applyTheme(selectedTheme);localStorage.setItem('garticSelectedTheme',selectedTheme)})}
function applyTheme(themeName){document.body.className='';document.body.classList.add(`theme-${themeName}`)}
function scrollToTop(){window.scrollTo({top:0,behavior:'smooth'})}
function handleScrollButtonVisibility(){const scrollTopBtn=document.getElementById('scrollTopBtn');if(document.body.scrollTop>200||document.documentElement.scrollTop>200){scrollTopBtn.style.display="block"}else{scrollTopBtn.style.display="none"}}
function startAutoRefresh(){fetchAllRoomData()}
function handleRefresh(){if(sharedCooldownTimerId){return}
applySharedCooldown(cooldownDuration/1000);roomStatusMessageElement.textContent='';if(refreshIntervalId){clearInterval(refreshIntervalId)}
if(currentMainFetchAbortController){currentMainFetchAbortController.abort();currentMainFetchAbortController=null}
window.roomData={};existingPlayerIds.clear();document.getElementById('players-list-container').innerHTML='';setTimeout(()=>{startAutoRefresh()},2000)}
document.addEventListener('DOMContentLoaded',()=>{populateLanguageSelect();populateThemeSelect();loadFavorites();loadBlacklist();setupFilterButtons();setupSearchInput();document.getElementById('refresh-button').disabled=!0;applySharedCooldown(cooldownDuration/1000);document.getElementById('refresh-button').addEventListener('click',handleRefresh);document.getElementById('players-list-container').addEventListener('click',(event)=>{const targetFavoriteButton=event.target.closest('.favorite-button');const targetBlacklistButton=event.target.closest('.blacklist-button');if(targetFavoriteButton){event.stopPropagation();const playerId=targetFavoriteButton.dataset.playerId;if(favoritePlayerIds.has(playerId)){removeFavorite(playerId)}else{addFavorite(playerId)}}else if(targetBlacklistButton){event.stopPropagation();const playerId=targetBlacklistButton.dataset.playerId;if(blacklistedPlayerIds.has(playerId)){removeBlacklist(playerId)}else{addBlacklist(playerId)}}});window.onscroll=function(){handleScrollButtonVisibility()};startAutoRefresh()})</script></body></html>
